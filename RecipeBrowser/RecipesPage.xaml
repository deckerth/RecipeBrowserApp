<Page x:Name="page"
    x:Class="RecipeBrowser.RecipesPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:RecipeBrowser"
    xmlns:converters="using:RecipeBrowser.ValueConverters"
    xmlns:controls="using:RecipeBrowser.Controls"
    xmlns:viewmodels="using:RecipeBrowser.ViewModels"
    xmlns:selectors="using:RecipeBrowser.TemplateSelectors"
    xmlns:fa="using:FontAwesome.UWP"      
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:muxc="using:Microsoft.UI.Xaml.Controls"
    mc:Ignorable="d" FontFamily="Segoe MDL2 Assets">

    <Page.Transitions>
        <TransitionCollection>
            <NavigationThemeTransition />
        </TransitionCollection>
    </Page.Transitions>

    <Page.Resources>
        <ResourceDictionary>
            <SymbolIconSource x:Key="PinIcon2" Symbol="Pin"/>
            <SymbolIconSource x:Key="UnPinIcon" Symbol="UnPin"/>
            <FontIconSource x:Key="PinIcon" FontFamily="Segoe UI Symbol" 
                                    FontSize="34" 
                                    Glyph="&#xE141;" />

            <SwipeItems x:Key="PinOptions" Mode="Execute">
                <SwipeItem x:Uid="Pin" IconSource="{StaticResource PinIcon}"
                           Invoked="RecipePin_Execute"
                           Background="DarkGreen" />
            </SwipeItems>

            <SwipeItems x:Key="UnPinOptions" Mode="Execute">
                <SwipeItem x:Uid="Unpin" IconSource="{StaticResource UnPinIcon}" 
                           Invoked="RecipeUnpin_Execute"                           
                           Background="DarkRed"
                           />
            </SwipeItems>

            <converters:PositiveIntToVisibilityConverter x:Key="positiveIntToVisConverter"/>
            <converters:IntegerToCaloriesStringConverter x:Key="intToCaloriesConverter"/>
            <converters:ColorToBrushConverter x:Key="colorToBrushConverter"/>
            <converters:BooleanToSwipeItemsConverter x:Key="unPipOptionsToSwipeItemsConverter" Items="{StaticResource UnPinOptions}"/>
            <converters:BooleanToSwipeItemsConverter x:Key="pinOptionsToSwipeItemsConverter" Items="{StaticResource PinOptions}"/>
            <local:BooleanToVisibilityConverter x:Key="boolToVisConverter"/>

            <CollectionViewSource x:Name="GroupedRecipesCVS"  IsSourceGrouped="True" />

            <DataTemplate x:Key="RecipeItemListTemplate" x:DataType="local:Recipe">
                <UserControl PointerEntered="RecipeItemListSwipeControl_PointerEntered" PointerExited="RecipeItemListSwipeControl_PointerExited">
                    <SwipeControl x:Name="RecipeItemListSwipeControl"
                              RightItems="{x:Bind IsFavorite, Mode=OneWay, Converter={StaticResource unPipOptionsToSwipeItemsConverter}}" 
                              LeftItems="{x:Bind IsFavorite, Mode=OneWay, Converter={StaticResource pinOptionsToSwipeItemsConverter}, ConverterParameter=true}"
                              >
                        <Grid Margin="6">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                <TextBlock  FontFamily="Segoe MDL2 Assets" 
                                    FontSize="34" 
                                    Text="&#xE8B7;  " 
                                    Visibility="{x:Bind FolderIconVisibility}"/>

                                <StackPanel Orientation="Vertical"  HorizontalAlignment="Left" Height="Auto" VerticalAlignment="Top" Width="Auto">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="{x:Bind Name, Mode=OneWay}" 
                                       FontFamily="Segoe UI Semilight"
                                       FontSize="18"
                                       FontWeight="SemiLight" />
                                        <Button x:Name="SubCategoryMenu" ToolTipService.ToolTip="" VerticalAlignment="Center" 
                                              Foreground="Black"
                                              FontFamily="Segoe MDL2 Assets" 
                                              FontSize="14" 
                                              Content="&#xE712;" 
                                              HorizontalAlignment="Center" Visibility="{x:Bind FolderIconVisibility}" Margin="20,0,0,0" Style="{StaticResource TextBlockButtonStyle}">
                                            <Button.Flyout>
                                                <MenuFlyout x:Name="SubCategoryOpsFlyout">
                                                    <MenuFlyoutItem x:Uid="RenameSubCategory" 
                                                            CommandParameter="{x:Bind Path, Mode=OneWay}"
                                                            Text="" x:Name="RenameSubCategory" Click="RenameSubCategory_Click"/>
                                                    <MenuFlyoutItem x:Uid="DeleteSubCategory" Text="" 
                                                            CommandParameter="{x:Bind Path, Mode=OneWay}"
                                                            x:Name="DeleteSubCategory" Click="DeleteSubCategory_ClickAsync" FontFamily="Segoe MDL2 Assets"/>
                                                </MenuFlyout>
                                            </Button.Flyout>
                                        </Button>
                                    </StackPanel>
                                    <TextBlock Text="{x:Bind SubTitle, Mode=OneWay}" 
                                       FontFamily="Segoe UI Semilight"
                                       FontSize="14"
                                       FontWeight="Normal" />
                                    <TextBlock Text="{x:Bind Calories, Mode=OneWay, Converter={StaticResource intToCaloriesConverter}}" Visibility="{x:Bind Calories,Mode=OneWay,Converter={StaticResource positiveIntToVisConverter}}" 
                                       FontFamily="Segoe UI Semilight"
                                       FontSize="14"
                                       FontWeight="Normal" />
                                </StackPanel>
                            </StackPanel>
                            <local:HoverButton x:Name="PinItemButton" 
                                               Grid.Column="1" 
                                               FontFamily="Segoe MDL2 Assets" 
                                               FontSize="24" 
                                               Glyph="&#xE718;"
                                               SelectedForeground="{StaticResource PinBrush}" 
                                               PressedForeground="{StaticResource PinBrush}"
                                               ForegroundBrush="{StaticResource AppBarButtonForegroundBrush}"
                                               HorizontalAlignment="Right" 
                                               Visibility="{x:Bind converters:BooleanOperator.VisAndNot(PointerEntered,IsFavorite), Mode=OneWay}" 
                                               Command="{x:Bind AddToFavoritesCommand}" />
                            <local:HoverButton x:Name="UnPinItemButton" 
                                               Grid.Column="1" 
                                               FontFamily="Segoe MDL2 Assets" 
                                               FontSize="24" 
                                               Glyph="&#xE77A;"
                                               SelectedForeground="{StaticResource UnPinBrush}" 
                                               PressedForeground="{StaticResource UnPinBrush}"
                                               ForegroundBrush="{StaticResource AppBarButtonForegroundBrush}"
                                               HorizontalAlignment="Right" 
                                               Visibility="{x:Bind IsFavorite, Mode=OneWay, Converter={StaticResource boolToVisConverter}}" 
                                               Command="{x:Bind RemoveFromFavoritesCommand}"/>

                        </Grid>
                    </SwipeControl>
                </UserControl>
            </DataTemplate>

            <DataTemplate x:Key="HelpItemListTemplate" x:DataType="local:Recipe">
                <Grid Margin="6">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                        <TextBlock  FontFamily="Segoe MDL2 Assets" 
                                    FontSize="34" 
                                    Text="&#xE8B7;  " 
                                    Visibility="{x:Bind FolderIconVisibility}"/>

                        <StackPanel Orientation="Vertical"  HorizontalAlignment="Left" Height="Auto" VerticalAlignment="Top" Width="Auto">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="{x:Bind Name, Mode=OneWay}" 
                                       FontFamily="Segoe UI Semilight"
                                       FontSize="18"
                                       FontWeight="SemiLight" />
                                <Button x:Name="SubCategoryMenu" ToolTipService.ToolTip="" VerticalAlignment="Center" 
                                              Foreground="Black"
                                              FontFamily="Segoe MDL2 Assets" 
                                              FontSize="14" 
                                              Content="&#xE712;" 
                                              HorizontalAlignment="Center" Visibility="{x:Bind FolderIconVisibility}" Margin="20,0,0,0" Style="{StaticResource TextBlockButtonStyle}">
                                    <Button.Flyout>
                                        <MenuFlyout x:Name="SubCategoryOpsFlyout">
                                            <MenuFlyoutItem x:Uid="RenameSubCategory" 
                                                            CommandParameter="{x:Bind Path, Mode=OneWay}"
                                                            Text="" x:Name="RenameSubCategory" Click="RenameSubCategory_Click"/>
                                            <MenuFlyoutItem x:Uid="DeleteSubCategory" Text="" 
                                                            CommandParameter="{x:Bind Path, Mode=OneWay}"
                                                            x:Name="DeleteSubCategory" Click="DeleteSubCategory_ClickAsync" FontFamily="Segoe MDL2 Assets"/>
                                        </MenuFlyout>
                                    </Button.Flyout>
                                </Button>
                            </StackPanel>
                            <TextBlock Text="{x:Bind SubTitle, Mode=OneWay}" 
                                       FontFamily="Segoe UI Semilight"
                                       FontSize="14"
                                       FontWeight="Normal" />
                            <TextBlock Text="{x:Bind Calories, Mode=OneWay, Converter={StaticResource intToCaloriesConverter}}" Visibility="{x:Bind Calories,Mode=OneWay,Converter={StaticResource positiveIntToVisConverter}}" 
                                       FontFamily="Segoe UI Semilight"
                                       FontSize="14"
                                       FontWeight="Normal" />
                        </StackPanel>
                    </StackPanel>
                </Grid>
            </DataTemplate>

            <DataTemplate x:Key="FavoritesItemListTemplate" x:DataType="local:Recipe">
                <SwipeControl x:Name="FavoritesItemListSwipeControl"
                              RightItems="{StaticResource UnPinOptions}" 
                              >
                    <Grid Margin="6">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <StackPanel HorizontalAlignment="Left" Height="Auto" VerticalAlignment="Top" Width="Auto">
                            <TextBlock Text="{x:Bind Name, Mode=OneWay}" 
                                       FontFamily="Segoe UI Semilight"
                                       FontSize="18"
                                       FontWeight="SemiLight" />
                            <TextBlock Text="{x:Bind FavoritesSubTitle, Mode=OneWay}" 
                                       FontFamily="Segoe UI Semilight"
                                       FontSize="14"
                                       FontWeight="Normal" />
                            <TextBlock Text="{x:Bind Calories, Mode=OneWay, Converter={StaticResource intToCaloriesConverter}}" Visibility="{x:Bind Calories,Mode=OneWay,Converter={StaticResource positiveIntToVisConverter}}" 
                                       FontFamily="Segoe UI Semilight"
                                       FontSize="14"
                                       FontWeight="Normal" />
                        </StackPanel>
                        <local:HoverButton x:Name="UnPinItemButton" 
                                               Grid.Column="1" 
                                               FontFamily="Segoe MDL2 Assets" 
                                               FontSize="24" 
                                               Glyph="&#xE77A;"
                                               SelectedForeground="{StaticResource UnPinBrush}" 
                                               PressedForeground="{StaticResource UnPinBrush}"
                                               ForegroundBrush="{StaticResource MenuBarForegroundBrush}"
                                               HorizontalAlignment="Right" 
                                               Command="{x:Bind RemoveFromFavoritesCommand}"/>
                    </Grid>

                </SwipeControl>
            </DataTemplate>

            <DataTemplate x:Key="HistoryItemListTemplate" x:DataType="local:Recipe" >
                <UserControl PointerEntered="RecipeItemListSwipeControl_PointerEntered" PointerExited="RecipeItemListSwipeControl_PointerExited">
                    <SwipeControl x:Name="HistoryItemListSwipeControl"
                              RightItems="{x:Bind IsFavorite, Mode=OneWay, Converter={StaticResource unPipOptionsToSwipeItemsConverter}}" 
                              LeftItems="{x:Bind IsFavorite, Mode=OneWay, Converter={StaticResource pinOptionsToSwipeItemsConverter}, ConverterParameter=true}"
                              >

                        <StackPanel>
                            <Border  BorderThickness="0,0,0,1" BorderBrush="{ThemeResource SystemControlForegroundBaseLowBrush}" Visibility="{x:Bind RecipeContentVisibility}">
                                <Grid Height="Auto" Width="500" Visibility="{x:Bind RecipeContentVisibility}">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="80"/>
                                    </Grid.ColumnDefinitions>
                                    <StackPanel HorizontalAlignment="Left" Height="Auto" 
                                                VerticalAlignment="Top" Width="460" >
                                        <TextBlock Text="{x:Bind Name, Mode=OneWay}" 
                                       FontFamily="Segoe UI Semilight"
                                       FontSize="18"
                                       FontWeight="SemiLight" 
                                       Padding="0,10,0,5"/>
                                        <Grid >
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="120"/>
                                            </Grid.ColumnDefinitions>
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="{x:Bind DisplayCategory}" 
                                           FontFamily="Segoe UI Semilight"
                                           FontSize="14"
                                           FontWeight="Normal" />
                                                <TextBlock Text="(" Visibility="{x:Bind Calories,Mode=OneWay,Converter={StaticResource positiveIntToVisConverter}}" 
                                           FontFamily="Segoe UI Semilight"
                                           FontSize="14"
                                           FontWeight="Normal" Margin="10,0,0,0" />
                                                <TextBlock Text="{x:Bind Calories, Mode=OneWay, Converter={StaticResource intToCaloriesConverter}}" Visibility="{x:Bind Calories,Mode=OneWay,Converter={StaticResource positiveIntToVisConverter}}" 
                                           FontFamily="Segoe UI Semilight"
                                           FontSize="14"
                                           FontWeight="Normal" />
                                                <TextBlock Text=")" Visibility="{x:Bind Calories,Mode=OneWay,Converter={StaticResource positiveIntToVisConverter}}" 
                                           FontFamily="Segoe UI Semilight"
                                           FontSize="14"
                                           FontWeight="Normal" />
                                            </StackPanel>
                                            <TextBlock Grid.Column="1" Text="{x:Bind LastCooked}" 
                                       FontFamily="Segoe UI Semilight"
                                       FontSize="14"
                                       FontWeight="Light" HorizontalAlignment="Right" Margin="0,0,40,0"/>
                                        </Grid>
                                        <TextBlock Text="{x:Bind ExternalSource}" 
                                       FontFamily="Segoe UI Semilight"
                                       FontSize="14"
                                       FontWeight="Normal"
                                       Visibility="{x:Bind ExternalSourceVisible}"/>
                                    </StackPanel>
                                    <local:HoverButton x:Name="PinItemButton" 
                                               Grid.Column="1" 
                                               FontFamily="Segoe MDL2 Assets" 
                                               FontSize="24" 
                                               Glyph="&#xE718;"
                                               SelectedForeground="{StaticResource PinBrush}" 
                                               PressedForeground="{StaticResource PinBrush}"
                                               ForegroundBrush="{StaticResource MenuBarForegroundBrush}"
                                               Visibility="{x:Bind converters:BooleanOperator.VisAndNot(PointerEntered,IsFavorite), Mode=OneWay}" 
                                               Command="{x:Bind AddToFavoritesCommand}"/>
                                    <local:HoverButton x:Name="UnPinItemButton" 
                                               Grid.Column="1" 
                                               FontFamily="Segoe MDL2 Assets" 
                                               FontSize="24" 
                                               Glyph="&#xE77A;"
                                               SelectedForeground="{StaticResource UnPinBrush}" 
                                               PressedForeground="{StaticResource UnPinBrush}"
                                               ForegroundBrush="{StaticResource MenuBarForegroundBrush}"
                                               Visibility="{x:Bind IsFavorite, Mode=OneWay, Converter={StaticResource boolToVisConverter}}" 
                                               Command="{x:Bind RemoveFromFavoritesCommand}"/>
                                </Grid>
                            </Border>
                            <Grid Visibility="{x:Bind HeaderContentVisibility}">
                                <TextBlock Text="{x:Bind Name}" 
                                       FontFamily="Segoe UI Semilight"
                                       FontSize="18"
                                       FontWeight="Medium" 
                                       Padding="0,10,0,5"/>
                            </Grid>
                        </StackPanel>
                    </SwipeControl>
                </UserControl>
            </DataTemplate>

            <DataTemplate x:Key="NarrowHistoryItemListTemplate" x:DataType="local:Recipe" >
                <SwipeControl x:Name="NarrowHistoryItemListSwipeControl"
                              RightItems="{x:Bind IsFavorite, Mode=OneWay, Converter={StaticResource unPipOptionsToSwipeItemsConverter}}" 
                              LeftItems="{x:Bind IsFavorite, Mode=OneWay, Converter={StaticResource pinOptionsToSwipeItemsConverter}, ConverterParameter=true}"
                              >
                    <StackPanel>
                        <Border  BorderThickness="0,0,0,1" BorderBrush="{ThemeResource SystemControlForegroundBaseLowBrush}" Visibility="{x:Bind RecipeContentVisibility}">
                            <Grid Height="Auto" Width="260" Visibility="{x:Bind RecipeContentVisibility}">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel HorizontalAlignment="Left" Height="Auto" VerticalAlignment="Top" Width="260" >
                                    <TextBlock Text="{x:Bind Name, Mode=OneWay}" 
                                       FontFamily="Segoe UI Semilight"
                                       FontSize="18"
                                       FontWeight="SemiLight" 
                                       Padding="0,10,0,5"/>
                                    <Grid >
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="80"/>
                                        </Grid.ColumnDefinitions>
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="{x:Bind Category}" 
                                           FontFamily="Segoe UI Semilight"
                                           FontSize="14"
                                           FontWeight="Normal" />
                                            <TextBlock Text="(" Visibility="{x:Bind Calories,Mode=OneWay,Converter={StaticResource positiveIntToVisConverter}}" 
                                           FontFamily="Segoe UI Semilight"
                                           FontSize="14"
                                           FontWeight="Normal" Margin="10,0,0,0" />
                                            <TextBlock Text="{x:Bind Calories, Mode=OneWay, Converter={StaticResource intToCaloriesConverter}}" Visibility="{x:Bind Calories,Mode=OneWay,Converter={StaticResource positiveIntToVisConverter}}" 
                                           FontFamily="Segoe UI Semilight"
                                           FontSize="14"
                                           FontWeight="Normal" />
                                            <TextBlock Text=")" Visibility="{x:Bind Calories,Mode=OneWay,Converter={StaticResource positiveIntToVisConverter}}" 
                                           FontFamily="Segoe UI Semilight"
                                           FontSize="14"
                                           FontWeight="Normal" />
                                        </StackPanel>
                                        <TextBlock Grid.Column="1" Text="{x:Bind LastCooked}" 
                                       FontFamily="Segoe UI Semilight"
                                       FontSize="14"
                                       FontWeight="Light" HorizontalAlignment="Right" />
                                    </Grid>
                                    <TextBlock Text="{x:Bind ExternalSource}" 
                                       FontFamily="Segoe UI Semilight"
                                       FontSize="14"
                                       FontWeight="Normal"
                                       Visibility="{x:Bind ExternalSourceVisible}"/>
                                </StackPanel>
                            </Grid>
                        </Border>
                        <Grid Visibility="{x:Bind HeaderContentVisibility}">
                            <TextBlock Text="{x:Bind Name}" 
                                       FontFamily="Segoe UI Semilight"
                                       FontSize="18"
                                       FontWeight="Medium" 
                                       Padding="0,10,0,5"/>
                        </Grid>
                    </StackPanel>
                </SwipeControl>
            </DataTemplate>

            <DataTemplate x:Key="DetailContentTemplate">
                <ScrollViewer
        		x:Name="itemDetail"
        		AutomationProperties.AutomationId="ItemDetailScrollViewer"
        		Padding="60,0,66,0"
        		DataContext="{Binding SelectedItem, ElementName=itemListView}"
        		HorizontalScrollBarVisibility="Visible"
        		ScrollViewer.HorizontalScrollMode="Enabled" ScrollViewer.VerticalScrollMode="Enabled"
        		ScrollViewer.ZoomMode="Enabled"  Grid.Row="1" Grid.RowSpan="2">
                    <Image x:Name="RecipeViewer"
                       ScrollViewer.HorizontalScrollBarVisibility="Visible" />
                </ScrollViewer>
            </DataTemplate>

            <DataTemplate x:Key="FolderSelectionTemplate" x:DataType="local:FolderDescriptor">
                <StackPanel Orientation="Horizontal">
                    <Rectangle Width="3" Height="18" Fill="{x:Bind IndicatorColor,Mode=OneWay}"/>
                    <TextBlock Text="{x:Bind CategoryWithIndent,Mode=OneWay}" Style="{StaticResource BaseTextBlockStyle}" Foreground="{x:Bind FontColor,Mode=OneWay}" Margin="5,0,0,0" />
                </StackPanel>
            </DataTemplate>

            <Style x:Key="TimerPanelStyle" TargetType="ListView">
                <Setter Property="Transitions">
                    <Setter.Value>
                        <TransitionCollection>
                            <PaneThemeTransition/>
                        </TransitionCollection>
                    </Setter.Value>
                </Setter>
            </Style>

            <MenuFlyout x:Key="AddRecipeMenuFlyoutDef" x:Name="AddRecipeMenuFlyout">
                <MenuFlyoutItem x:Uid="AddExistingPdf" Text="" x:Name="AddExistingPdf" />
                <MenuFlyoutItem x:Uid="EnterNewRecipe" Text="" x:Name="EnterNewRecipe" />
                <MenuFlyoutItem x:Uid="NewSubCategory" Text="" x:Name="NewSubCategory" />
            </MenuFlyout>

            <MenuFlyout x:Key="ExportImportFlyoutDef" x:Name="ExportImportFlyout" >
                <MenuFlyoutItem x:Name="ExportHistoryMenuItem" x:Uid="ExportHistory" Text="" Click="ExportHistory_Click" />
                <MenuFlyoutItem x:Name="ImportHistoryMenuItem" x:Uid="ImportHistory" Text="" Click="ImportHistory_Click"/>
            </MenuFlyout>

            <Flyout x:Key="NoteEditorFlyout" Closed="NoteEditorFlyoutClosed" >
                <StackPanel Orientation="Vertical">
                    <TextBlock x:Name="NoteEditorHeader" x:Uid="NoteEditorHeader"/>
                    <StackPanel Orientation="Horizontal">
                        <StackPanel.Resources>
                            <Style TargetType="Button">
                                <Setter Property="BorderThickness" Value="0" />
                                <Setter Property="Background" Value="Transparent"/>
                                <Setter Property="Margin" Value="0,0,8,0" />
                            </Style>
                        </StackPanel.Resources>

                        <Button x:Name="NoteTextBold" Click="NoteTextBoldClicked">
                            <Button.Content>
                                <FontIcon FontFamily="Segoe MDL2 Assets" Glyph="&#xE8DD;"/>
                            </Button.Content>
                        </Button>
                        <Button x:Name="NoteTextItalic" Click="NoteTextItalicClicked">
                            <Button.Content>
                                <FontIcon FontFamily="Segoe MDL2 Assets" Glyph="&#xE8DB;"/>
                            </Button.Content>
                        </Button>
                        <muxc:DropDownButton x:Name="NoteTextFontColor" AutomationProperties.Name="Font color"
                                BorderThickness="0" ToolTipService.ToolTip="Font color"
                                Background="Transparent"
                                >
                            <SymbolIcon Symbol="FontColor"/>
                            <muxc:DropDownButton.Flyout>
                                <Flyout Placement="Bottom">
                                    <VariableSizedWrapGrid Orientation="Horizontal" MaximumRowsOrColumns="3">
                                        <VariableSizedWrapGrid.Resources>
                                            <Style TargetType="Rectangle">
                                                <Setter Property="Width" Value="32"/>
                                                <Setter Property="Height" Value="32"/>
                                            </Style>
                                            <Style TargetType="Button">
                                                <Setter Property="Padding" Value="0"/>
                                                <Setter Property="MinWidth" Value="0"/>
                                                <Setter Property="MinHeight" Value="0"/>
                                                <Setter Property="Margin" Value="6"/>
                                            </Style>
                                        </VariableSizedWrapGrid.Resources>
                                        <Button Click="ColorButton_Click" AutomationProperties.Name="Red">
                                            <Button.Content>
                                                <Rectangle Fill="Red"/>
                                            </Button.Content>
                                        </Button>
                                        <Button Click="ColorButton_Click" AutomationProperties.Name="Orange">
                                            <Button.Content>
                                                <Rectangle Fill="Orange"/>
                                            </Button.Content>
                                        </Button>
                                        <Button Click="ColorButton_Click" AutomationProperties.Name="Yellow">
                                            <Button.Content>
                                                <Rectangle Fill="Yellow"/>
                                            </Button.Content>
                                        </Button>
                                        <Button Click="ColorButton_Click" AutomationProperties.Name="Green">
                                            <Button.Content>
                                                <Rectangle Fill="Green"/>
                                            </Button.Content>
                                        </Button>
                                        <Button Click="ColorButton_Click" AutomationProperties.Name="Blue">
                                            <Button.Content>
                                                <Rectangle Fill="Blue"/>
                                            </Button.Content>
                                        </Button>
                                        <Button Click="ColorButton_Click" AutomationProperties.Name="Indigo">
                                            <Button.Content>
                                                <Rectangle Fill="Indigo"/>
                                            </Button.Content>
                                        </Button>
                                        <Button Click="ColorButton_Click" AutomationProperties.Name="White">
                                            <Button.Content>
                                                <Rectangle Fill="White"/>
                                            </Button.Content>
                                        </Button>
                                        <Button Click="ColorButton_Click" AutomationProperties.Name="Black">
                                            <Button.Content>
                                                <Rectangle Fill="Black"/>
                                            </Button.Content>
                                        </Button>
                                    </VariableSizedWrapGrid>
                                </Flyout>
                            </muxc:DropDownButton.Flyout>
                        </muxc:DropDownButton>
                    </StackPanel>
                    <RichEditBox x:Uid="NoteEditor" x:Name="noteEditor" Height="450" Width="400" RequestedTheme="Light" Background="White">
                        <RichEditBox.HeaderTemplate>
                            <DataTemplate>
                            </DataTemplate>
                        </RichEditBox.HeaderTemplate>
                    </RichEditBox>
                    <Grid Margin="0,10,0,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="335"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <TextBox x:Name="InternetLinkTextBox" x:Uid="InternetLinkTextBox" PlaceholderText="http://..." Width="335"/>
                        <AppBarButton x:Name="OpenInternetLink" Grid.Column="1" Icon="Globe" />
                    </Grid>
                </StackPanel>
            </Flyout>

            <DataTemplate x:Key="WrappedItemDataTemplate" x:DataType="viewmodels:RecipeTagViewModel">
                <Border Margin="0,0" BorderThickness="1,1,1,1" CornerRadius="15,15,15,15" BorderBrush="{x:Bind Foreground,Mode=OneWay,Converter={StaticResource colorToBrushConverter}}"
                        Background="{x:Bind Background,Mode=OneWay,Converter={StaticResource colorToBrushConverter}}">
                    <StackPanel VerticalAlignment="Center" Orientation="Horizontal">
                        <TextBlock VerticalAlignment="Center" 
                               Style="{StaticResource WrappedItemTextStyle}"
                               Foreground="{x:Bind Foreground,Mode=OneWay,Converter={StaticResource colorToBrushConverter}}"
                               Text="{x:Bind Tag}" />
                        <Button Background="Transparent" Command="{x:Bind AddDeleteCommand}">
                            <Button.Content>
                                <Border BorderBrush="{x:Bind Foreground,Mode=OneWay,Converter={StaticResource colorToBrushConverter}}" BorderThickness="2" CornerRadius="45,45,45,45">
                                    <FontIcon Glyph="&#xE711;" Foreground="{x:Bind Foreground,Mode=OneWay,Converter={StaticResource colorToBrushConverter}}"/>
                                </Border>
                            </Button.Content>
                        </Button>
                    </StackPanel>
                </Border>
            </DataTemplate>

            <DataTemplate x:Key="WrappedPlusDataTemplate" x:DataType="viewmodels:RecipeTagViewModel">
                <Button Background="Transparent" Command="{x:Bind AddDeleteCommand}">
                    <Button.Content>
                        <Border BorderBrush="DarkGray" BorderThickness="2" CornerRadius="45,45,45,45">
                            <FontIcon Glyph="&#xE710;" Margin="4,4"/>
                        </Border>
                    </Button.Content>
                </Button>
            </DataTemplate>

            <selectors:TagDataTemplateSelector x:Key="tagTemplateSelector"
                                    DefaultDataDemplate="{StaticResource WrappedItemDataTemplate}"
                                    PlusDataTemplate="{StaticResource WrappedPlusDataTemplate}"/>

            <Style x:Key="WrappedItemsControlStyle" TargetType="ListView">
                <Setter Property="ItemsPanel" Value="{StaticResource HorizontalItemsPanel}" />
                <Setter Property="BorderThickness" Value="0" />
                <Setter Property="BorderBrush" Value="DarkGray" />
                <Setter Property="Margin" Value="6" />
            </Style>

        </ResourceDictionary>
    </Page.Resources>

    <SplitView x:Name="RootSplitView"
          IsPaneOpen="False"
           OpenPaneLength="350" 
           CompactPaneLength="70" 
           DisplayMode="CompactOverlay" PaneBackground="{StaticResource MenuBarBackgroundBrush}">
        <VisualStateManager.VisualStateGroups>
            <VisualStateGroup x:Name="AdaptiveStates" CurrentStateChanged="AdaptiveStates_CurrentStateChanged">
                <VisualState x:Name="DefaultState">
                    <VisualState.StateTriggers>
                        <AdaptiveTrigger MinWindowWidth="1024" />
                    </VisualState.StateTriggers>
                </VisualState>
                <VisualState x:Name="NarrowState">
                    <VisualState.StateTriggers>
                        <AdaptiveTrigger MinWindowWidth="800" />
                    </VisualState.StateTriggers>

                    <VisualState.Setters>
                        <Setter Target="MasterColumn.Width" Value="*" />
                        <Setter Target="DetailColumn.Width" Value="0" />
                        <Setter Target="MasterListView.SelectionMode" Value="None" />
                    </VisualState.Setters>
                </VisualState>
                <VisualState x:Name="PhoneState">
                    <VisualState.StateTriggers>
                        <AdaptiveTrigger MinWindowWidth="0" />
                    </VisualState.StateTriggers>
                    <VisualState.Setters>
                        <!--<Setter Target="RecipeSearchBox.(FrameworkElement.Width)" Value="220"/>-->
                        <Setter Target="RecipeAutoSuggestBox.(FrameworkElement.Width)" Value="220"/>
                        <Setter Target="MasterColumn.Width" Value="*" />
                        <Setter Target="DetailColumn.Width" Value="0" />
                        <Setter Target="MasterListView.SelectionMode" Value="None" />
                    </VisualState.Setters>
                </VisualState>
            </VisualStateGroup>
        </VisualStateManager.VisualStateGroups>

        <SplitView.Pane>
            <ScrollViewer>
                <StackPanel Orientation="Vertical">
                    <Button x:Name="BackButton" Style="{StaticResource NavigationBackButtonNormalStyle}" Foreground="{StaticResource MenuBarForegroundBrush}" Margin="10,0,0,0"
                        Visibility="{x:Bind BackButtonVisibility,Mode=OneWay}"/>
                    <AppBarButton x:Name="ToggleSplitView" Style="{StaticResource MenuBarButtonStyle}"
                                    VerticalAlignment="Top" 
                                    HorizontalAlignment="Left" 
                                    VerticalContentAlignment="Center"
                                    HorizontalContentAlignment="Center"
                                    FontFamily="{StaticResource Icons}" 
                                    FontSize="20" 
                                    Content="&#xE700;"
                                    Foreground="{StaticResource MenuBarForegroundBrush}"/>

                    <StackPanel x:Name="AddExternalRecipeButton" Orientation="Horizontal" VerticalAlignment="Top" HorizontalAlignment="Left">
                        <AppBarButton x:Name="AddExternalRecipe" x:Uid="AddRecipeTooltip" Style="{StaticResource MenuBarButtonStyle}"
                                    FontFamily="{StaticResource Icons}" 
                                    FontSize="20" 
                                    Content="&#xE710;"
                                    VerticalAlignment="Center" 
                                    HorizontalAlignment="Center"  
                                    Foreground="{StaticResource MenuBarForegroundBrush}">
                        </AppBarButton>
                        <TextBlock x:Name="AddExternalRecipeText" x:Uid="AddRecipe"
                    		FontSize="18" FontFamily="Segoe UI"
                    		VerticalAlignment="Center"
                    		HorizontalAlignment="Left" Margin="5,-15,0,0"
                            Foreground="{StaticResource MenuBarForegroundBrush}" Tapped="AddExternalRecipe_Tapped"/>
                    </StackPanel>

                    <StackPanel x:Name="AddRecipeButton" Orientation="Horizontal" VerticalAlignment="Top" HorizontalAlignment="Left">
                        <AppBarButton x:Name="AddRecipe" x:Uid="AddRecipeTooltip" Style="{StaticResource MenuBarButtonStyle}"
                                    FontFamily="{StaticResource Icons}" 
                                    FontSize="20" 
                                    Content="&#xE710;"                                     
                                    VerticalAlignment="Center" 
                                    HorizontalAlignment="Center"  
                                    Foreground="{StaticResource MenuBarForegroundBrush}"
                                    Flyout="{StaticResource AddRecipeMenuFlyoutDef}">
                        </AppBarButton>
                        <TextBlock x:Name="AddRecipeTextblock" x:Uid="AddRecipe"
                    		FontSize="18" FontFamily="Segoe UI"
                    		VerticalAlignment="Center"
                    		HorizontalAlignment="Left" Margin="5,-15,0,0"
                            Foreground="{StaticResource MenuBarForegroundBrush}"/>
                    </StackPanel>

                    <StackPanel x:Name="HomeButton" Orientation="Horizontal" VerticalAlignment="Top" HorizontalAlignment="Left">
                        <AppBarButton x:Name="Home" x:Uid="HomeTooltip" Style="{StaticResource MenuBarButtonStyle}"
                                    FontFamily="{StaticResource Icons}" 
                                    FontSize="20" 
                                    Content="&#xE80F;"
                                    VerticalAlignment="Center" 
                                    HorizontalAlignment="Center"  
                                    Foreground="{StaticResource MenuBarForegroundBrush}" 
                                    >
                                  </AppBarButton>
                        <TextBlock x:Uid="Home" x:Name="HomeTextblock"
                    		FontSize="18" FontFamily="Segoe UI"
                    		VerticalAlignment="Center"
                    		HorizontalAlignment="Left" Margin="5,-15,0,0"
                            Foreground="{StaticResource MenuBarForegroundBrush}" 
                            />
                    </StackPanel>

                    <StackPanel x:Name="ShowFavoritesButton" Orientation="Horizontal" VerticalAlignment="Top" HorizontalAlignment="Left" >
                        <AppBarButton x:Name="ShowFavorites" x:Uid="ShowFavorites" Style="{StaticResource MenuBarButtonStyle}"
                                    FontSize="30" 
                                    VerticalAlignment="Center" 
                                    HorizontalAlignment="Center" 
                                    Foreground="{StaticResource MenuBarForegroundBrush}" >
                            <AppBarButton.Content>
                                <Grid>
                                    <FontIcon FontFamily="{StaticResource Icons}" Glyph="&#xE718;"/>
                                    <FontIcon x:Name="ShowFavorites_Filled" FontFamily="{StaticResource Icons}" Glyph="&#xE841;" Visibility="Collapsed"/>
                                </Grid>
                            </AppBarButton.Content>
                        </AppBarButton>
                        <TextBlock x:Uid="FavoriteRecipesText" x:Name="FavoriteRecipesTextblock"
                    		FontSize="18" FontFamily="Segoe UI"
                    		VerticalAlignment="Center"
                    		HorizontalAlignment="Left" Margin="5,-15,0,0"
                            Foreground="{StaticResource MenuBarForegroundBrush}"/>
                    </StackPanel>

                    <StackPanel x:Name="LastAddedSearchButton" Orientation="Horizontal" VerticalAlignment="Top" HorizontalAlignment="Left" >
                        <AppBarButton x:Name="ShowLastAdded" x:Uid="ShowLastAddedTooltip" Style="{StaticResource MenuBarButtonStyle}"
                                  VerticalAlignment="Center" 
                                  HorizontalAlignment="Center" 
                                  Foreground="{ThemeResource MenuBarForegroundBrush}"
                                  FontFamily="{StaticResource Icons}"
                                  Content="&#xF738;" >
                            <AppBarButton.Flyout>
                                <MenuFlyout>
                                    <MenuFlyoutItem x:Name="AddedSinceLastMonth" x:Uid="AddedSinceLastMonth" Click="AddedSinceLastMonth_Click"/>
                                    <MenuFlyoutItem x:Name="AddedSinceLast3Month" x:Uid="AddedSinceLast3Month" Click="AddedSinceLast3Month_Click"/>
                                    <MenuFlyoutItem x:Name="AddedSinceDate" x:Uid="AddedSinceDate" Click="AddedSinceDate_Click"/>
                                </MenuFlyout>
                            </AppBarButton.Flyout>
                        </AppBarButton>
                        <TextBlock x:Uid="ShowLastAdded" x:Name="ShowLastAddedText"
                    		FontSize="18" FontFamily="Segoe UI"
                    		VerticalAlignment="Center"
                    		HorizontalAlignment="Left" Margin="5,-15,0,0"
                            Foreground="{ThemeResource MenuBarForegroundBrush}"/>
                    </StackPanel>

                    <StackPanel x:Name="ShowHistoryButton" Orientation="Horizontal" VerticalAlignment="Top" HorizontalAlignment="Left" >
                        <AppBarButton x:Name="ShowHistory"  x:Uid="ShowHistory" Style="{StaticResource MenuBarButtonStyle}"
                                  VerticalAlignment="Center" 
                                  HorizontalAlignment="Center" 
                                  Foreground="{StaticResource MenuBarForegroundBrush}" 
                                  FontFamily="{StaticResource Icons}" 
                                  FontSize="20" 
                                  Content="&#xE787;">
                       </AppBarButton>
                        <TextBlock x:Uid="ShowHistoryText" x:Name="ShowHistoryText"
                    		FontSize="18" FontFamily="Segoe UI"
                    		VerticalAlignment="Center"
                    		HorizontalAlignment="Left" Margin="5,-15,0,0"
                            Foreground="{StaticResource MenuBarForegroundBrush}" />
                    </StackPanel>

                    <StackPanel x:Name="ShowTimersButton" Orientation="Horizontal" VerticalAlignment="Top" HorizontalAlignment="Left" >
                        <AppBarButton x:Name="ShowTimers" x:Uid="ShowTimers" Style="{StaticResource MenuBarButtonStyle}"
                                  VerticalAlignment="Center" 
                                  HorizontalAlignment="Center" 
                                  Foreground="{StaticResource MenuBarForegroundBrush}" 
                                  FontFamily="{StaticResource Icons}" 
                                  FontSize="20" 
                                  Content="&#xE916;">
                        </AppBarButton>
                        <TextBlock x:Uid="ShowTimersText" x:Name="ShowTimersText"
                    		FontSize="18" FontFamily="Segoe UI"
                    		VerticalAlignment="Center"
                    		HorizontalAlignment="Left" Margin="5,-15,0,0"
                            Foreground="{StaticResource MenuBarForegroundBrush}"/>
                    </StackPanel>

                    <StackPanel x:Name="FolderSelectionButton" Orientation="Horizontal" VerticalAlignment="Top" HorizontalAlignment="Left" >
                        <AppBarButton x:Name="FolderSelection" x:Uid="FolderSelection" Style="{StaticResource MenuBarButtonStyle}"
                                  VerticalAlignment="Center" 
                                  HorizontalAlignment="Center" 
                                  Foreground="{StaticResource MenuBarForegroundBrush}" 
                                  FontFamily="{StaticResource Icons}" 
                                  FontSize="20" 
                                  Content="&#xF12B;" >
                        </AppBarButton>
                        <TextBlock x:Uid="FolderSelectionText" x:Name="FolderSelectionText"
                    		FontSize="18" FontFamily="Segoe UI"
                    		VerticalAlignment="Center"
                    		HorizontalAlignment="Left" Margin="5,-15,0,0"
                            Foreground="{StaticResource MenuBarForegroundBrush}"/>
                    </StackPanel>

                    <StackPanel x:Name="CriteriaSelectionPane"
                    Orientation="Horizontal" VerticalAlignment="Top" HorizontalAlignment="Left">
                        <AppBarButton x:Name="CriteriaSelection" x:Uid="CriteriaSelection" Style="{StaticResource MenuBarButtonStyle}"
                                  VerticalAlignment="Center" 
                                  HorizontalAlignment="Center" 
                                  Foreground="{ThemeResource MenuBarForegroundBrush}"
                                  Click="CriteriaSelection_Click"
                                  FontFamily="{StaticResource Icons}" 
                                  FontSize="20" 
                                  Content="&#xE8EC;" >
                        </AppBarButton>
                        <TextBlock x:Uid="CriteriaSelectionText" x:Name="CriteriaSelectionText"
                    		FontSize="18" FontFamily="Segoe UI"
                    		VerticalAlignment="Center"
                    		HorizontalAlignment="Left" Margin="5,-15,0,0"
                            Foreground="{ThemeResource MenuBarForegroundBrush}"/>
                    </StackPanel>

                    <StackPanel x:Name="RefreshRecipesButton" Orientation="Horizontal" VerticalAlignment="Top" HorizontalAlignment="Left" >
                        <AppBarButton x:Name="refreshRecipes" x:Uid="RefreshRecipesTooltip" Style="{StaticResource MenuBarButtonStyle}"
                                  VerticalAlignment="Center" 
                                  HorizontalAlignment="Center" 
                                  Foreground="{StaticResource MenuBarForegroundBrush}" 
                                  FontFamily="{StaticResource Icons}" 
                                  FontSize="20" 
                                  Content="&#xE72C;" >
                        </AppBarButton>
                        <TextBlock x:Uid="RefreshRecipes" x:Name="RefreshRecipesText"
                    		FontSize="18" FontFamily="Segoe UI"
                    		VerticalAlignment="Center"
                    		HorizontalAlignment="Left" Margin="5,-15,0,0"
                            Foreground="{StaticResource MenuBarForegroundBrush}"/>
                    </StackPanel>

                    <StackPanel x:Name="ExportImportButton" Orientation="Horizontal" VerticalAlignment="Top" HorizontalAlignment="Left" >
                        <AppBarButton x:Name="ExportImport" x:Uid="ExportImport" Style="{StaticResource MenuBarButtonStyle}"
                                  VerticalAlignment="Center" 
                                  HorizontalAlignment="Center" 
                                  Foreground="{StaticResource MenuBarForegroundBrush}" 
                                  FontFamily="{StaticResource Icons}" 
                                  FontSize="20" 
                                  Content="&#xE896;" 
                                  Flyout="{StaticResource ExportImportFlyoutDef}">
                        </AppBarButton>
                        <TextBlock x:Uid="ImportExportHistory" x:Name="ImportExportHistoryText"
                    		FontSize="18" FontFamily="Segoe UI"
                    		VerticalAlignment="Center"
                    		HorizontalAlignment="Left" Margin="5,-15,0,0"
                            Foreground="{StaticResource MenuBarForegroundBrush}"/>
                    </StackPanel>

                    <TextBlock HorizontalAlignment="Left" VerticalAlignment="Top"/>

                    <StackPanel x:Name="AppHelpButton" Orientation="Horizontal" VerticalAlignment="Top" HorizontalAlignment="Left" >
                        <AppBarButton x:Name="AppHelp" x:Uid="AppHelpTooltip" Style="{StaticResource MenuBarButtonStyle}"
                                  Foreground="{StaticResource MenuBarForegroundBrush}" 
                                  FontFamily="{StaticResource Icons}" 
                                  FontSize="20" 
                                  Content="&#xE897;" 
                            />
                        <TextBlock x:Uid="AppHelp" x:Name="AppHelpText"
                    		FontSize="18" FontFamily="Segoe UI"
                    		VerticalAlignment="Center"
                    		HorizontalAlignment="Left" Margin="5,-15,0,0"
                            Foreground="{StaticResource MenuBarForegroundBrush}"/>
                    </StackPanel>
                </StackPanel>
            </ScrollViewer>
        </SplitView.Pane>

        <SplitView x:Name="FolderSelectionSplitView"
           IsPaneOpen="False"
           OpenPaneLength="296" 
           DisplayMode="Overlay" PaneBackground="{StaticResource MenuBarBackgroundBrush}">
            <SplitView.Pane>
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    <TextBlock x:Name="CategoryChooserTitle" Grid.Row="0" Visibility="Visible" Style="{StaticResource FlyoutPickerTitleTextBlockStyle}"  Padding="0,10,0,0"/>
                    <ListView x:Name="FolderSelectionList" Grid.Row="1" Width="300" ItemTemplate="{StaticResource FolderSelectionTemplate}" Background="{StaticResource MenuBarBackgroundBrush}" IsItemClickEnabled="True" SelectionMode="None" ItemClick="Category_Chosen" Foreground="{StaticResource MenuBarForegroundBrush}" HorizontalAlignment="Left" VerticalAlignment="Top" />
                </Grid>
            </SplitView.Pane>

            <Grid x:Name="LayoutRoot" Loaded="LayoutRoot_Loaded" Background="{StaticResource RecipesItemsBackgroundBrush}">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <Grid.ColumnDefinitions>
                    <ColumnDefinition x:Name="MasterColumn" Width="500" />
                    <ColumnDefinition x:Name="DetailColumn" Width="*" />
                </Grid.ColumnDefinitions>

                <Border Grid.Row="0" Grid.ColumnSpan="2" BorderBrush="{StaticResource MenuBarBottomSeparatorLine}" BorderThickness="0,0,0,1">
                    <CommandBar  Opening="CommandBar_Opening" Closing="CommandBar_Closing">
                        <CommandBar.Content>
                            <StackPanel Orientation="Horizontal" Margin="10,0,0,0">
                                <TextBlock Grid.Row="0" Grid.Column="0" x:Name="pageTitle"
                                       Style="{ThemeResource TitleTextBlockStyle}" />
                                <ProgressRing x:Name="actionProgress" HorizontalAlignment="Center" VerticalAlignment="Center" Width="40" Height="40" Margin="0,0,0,15" />
                            </StackPanel>
                        </CommandBar.Content>
                        <AppBarButton x:Name="logAsCooked" x:Uid="LogAsCooked" HorizontalAlignment="Stretch" Label="" VerticalAlignment="Stretch" 
                                  >
                            <AppBarButton.Flyout>
                                <DatePickerFlyout x:Name="CookedOn" Placement="Bottom">

                                </DatePickerFlyout>
                            </AppBarButton.Flyout>
                            <AppBarButton.Icon>
                                <FontIcon FontFamily="{StaticResource Icons}" Glyph="&#xE8E1;"/>
                            </AppBarButton.Icon>
                        </AppBarButton>
                        <AppBarButton x:Uid="EditNote" x:Name="editNote" HorizontalAlignment="Stretch" Label="" VerticalAlignment="Stretch" IsEnabled="False"
                                  Flyout="{StaticResource NoteEditorFlyout}">
                            <AppBarButton.Icon>
                                <FontIcon FontFamily="{StaticResource Icons}" Glyph="&#xE8BD;"/>
                            </AppBarButton.Icon>
                        </AppBarButton>
                        <AppBarButton x:Uid="EditFile" ToolTipService.ToolTip="" x:Name="EditFileButton" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Visibility="Collapsed" >
                            <AppBarButton.Icon>
                                <FontIcon FontFamily="{StaticResource Icons}" Glyph="&#xE70F;"/>
                            </AppBarButton.Icon>
                        </AppBarButton>
                        <AppBarButton x:Uid="EditTags" ToolTipService.ToolTip="" x:Name="EditTags" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" >
                            <AppBarButton.Icon>
                                <FontIcon FontFamily="{StaticResource Icons}" Glyph="&#xE8EC;"/>
                            </AppBarButton.Icon>
                        </AppBarButton>
                        <AppBarButton x:Uid="ImageGalery" ToolTipService.ToolTip="" x:Name="ShowImageGalery" HorizontalAlignment="Stretch" VerticalAlignment="Stretch"  >
                            <AppBarButton.Icon>
                                <FontIcon FontFamily="{StaticResource Icons}" Glyph="&#xE8B9;"/>
                            </AppBarButton.Icon>
                        </AppBarButton>
                        <AppBarButton x:Uid="FullscreenView" ToolTipService.ToolTip="" x:Name="FullscreenView" HorizontalAlignment="Stretch" VerticalAlignment="Stretch"  >
                            <AppBarButton.Icon>
                                <FontIcon FontFamily="{StaticResource Icons}" Glyph="&#xE740;"/>
                            </AppBarButton.Icon>
                        </AppBarButton>
                        <AppBarButton x:Uid="AddToFavorites" ToolTipService.ToolTip="" x:Name="AddToFavorites" Label="" Icon="Pin" />
                        <AppBarButton x:Uid="RemoveRecipe" ToolTipService.ToolTip="" x:Name="RemoveFromFavorites" HorizontalAlignment="Stretch" Label="" VerticalAlignment="Stretch" Visibility="Collapsed" Icon="UnPin" />
                        <CommandBar.SecondaryCommands>
                            <AppBarButton x:Uid="OpenRecipeCommand" x:Name="OpenFile" Icon="OpenFile"/>
                            <AppBarButton x:Uid="ShareCommand" x:Name="Share" Icon="Share"/>
                            <AppBarButton x:Uid="ChangeCategoryCommand" x:Name="ChangeCategory" />
                            <AppBarButton x:Uid="RenameRecipeCommand" x:Name="RenameRecipe" Icon="Rename"/>
                            <AppBarButton x:Uid="DeleteRecipeCommand" x:Name="deleteRecipe" Icon="Delete" />
                            <AppBarButton x:Uid="ChangeCaloriesCommand" x:Name="ChangeCalories" >
                                <AppBarButton.Icon>
                                    <FontIcon FontFamily="Segoe MDL2 Assets" Glyph="&#xECAD;"/>
                                </AppBarButton.Icon>
                            </AppBarButton>
                            <AppBarSeparator/>
                            <AppBarButton x:Uid="ScanForCaloriesCommand"  x:Name="ScanForCalories" />
                        </CommandBar.SecondaryCommands>
                    </CommandBar>
                </Border>

                <Grid Grid.Row="1" Grid.RowSpan="2" Grid.Column="0" x:Name="RecipeList">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <StackPanel x:Name="searchFieldPanel" 
                                    Grid.Row="0" 
                                    HorizontalAlignment="Left" 
                                    VerticalAlignment="Center" 
                                    Orientation="Horizontal">
                        <AppBarButton x:Name="changeSortOrder" x:Uid="changeSortOrder" HorizontalAlignment="Center" VerticalAlignment="Center" Icon="Sort">
                            <Button.Flyout>
                                <MenuFlyout>
                                    <MenuFlyoutItem x:Uid="NameAscending" Text="" Click="SortNameAscending_Click"/>
                                    <MenuFlyoutItem x:Uid="DateDescending" Text="" Click="SortDateDecending_Click"/>
                                    <MenuFlyoutItem x:Uid="LastCookedDescending" Text="" Click="SortLastCookedDescending_Click"/>
                                </MenuFlyout>
                            </Button.Flyout>
                        </AppBarButton>
                        <AppBarButton x:Name="setFilter" x:Uid="setFilter" Icon="Filter" Visibility="Collapsed" />
                        <AppBarButton x:Name="deleteFilter" x:Uid="deleteFilter" Icon="Undo" Visibility="Collapsed" />
                        <TextBlock x:Name="SearchBoxSpaceHolder" Height="50"/>
                        <SearchBox x:Name="RecipeSearchBox" Background="{StaticResource RecipesItemsBackgroundBrush}" Width="374" Height="34" QuerySubmitted="SearchBox_QuerySubmitted" Visibility="Collapsed"/>
                        <AutoSuggestBox x:Name="RecipeAutoSuggestBox"
                                        Background="{StaticResource RecipesItemsBackgroundBrush}"
                                        Width="374" Height="34" 
                                        Visibility="Collapsed"  
                                        VerticalAlignment="Center"
                                        QueryIcon="Find"/>
                        <AppBarButton x:Name="chooseRandomRecipe" x:Uid="ChooseRandomRecipe" Click="ChooseRandomRecipe_Click">
                            <AppBarButton.Icon>
                                <PathIcon Data="M74.5 36A38.5 38.5 0 0 0 36 74.5v363A38.5 38.5 0 0 0 74.5 476h363a38.5 38.5 0 0 0 38.5-38.5v-363A38.5 38.5 0 0 0 437.5 36h-363zm48.97 36.03A50 50 0 0 1 172 122a50 50 0 0 1-100 0 50 50 0 0 1 51.47-49.97zm268 0A50 50 0 0 1 440 122a50 50 0 0 1-100 0 50 50 0 0 1 51.47-49.97zm-268 268A50 50 0 0 1 172 390a50 50 0 0 1-100 0 50 50 0 0 1 51.47-49.97zm268 0A50 50 0 0 1 440 390a50 50 0 0 1-100 0 50 50 0 0 1 51.47-49.97z"/>
                            </AppBarButton.Icon>
                        </AppBarButton>

                    </StackPanel>

                    <ProgressBar x:Name="LoadProgress"
                                     Grid.Row="1" 
                                     HorizontalAlignment="Center" 
                                     Height="10" 
                                     VerticalAlignment="Center" 
                                     Width="300" 
                                     IsIndeterminate="True" 
                                     FlowDirection="RightToLeft"
                                     Visibility="Collapsed"
                                     Foreground="{StaticResource ProgressBarForegroundThemeBrush}"/>
                    <ProgressBar x:Name="LoadProgressDeterminate"
                                     Grid.Row="1" 
                                     HorizontalAlignment="Center" 
                                     Height="10" 
                                     VerticalAlignment="Center" 
                                     Width="300" 
                                     Visibility="Collapsed"
                                     IsIndeterminate="False"
                                     Minimum="0"
                                     Value="0"
                                     Maximum="{x:Bind CurrentRecipeFolder.LoadProgressTotal,Mode=OneWay}"
                                     Foreground="{StaticResource ProgressBarForegroundThemeBrush}"/>

                    <ListView x:Name="MasterListView"
                            Grid.Row="2"
                            ItemContainerTransitions="{x:Null}"
                            IsItemClickEnabled="True"
                            ItemClick="ItemListView_SelectionChanged"
                            ItemTemplate="{StaticResource RecipeItemListTemplate}">
                        <ListView.GroupStyle>
                            <GroupStyle>
                                <GroupStyle.HeaderTemplate>
                                    <DataTemplate x:DataType="local:RecipesGroup">
                                        <Grid Height="Auto" Width="470">
                                            <Border Background="{StaticResource HistorySeparatorBackgroundBrush}"  >
                                                <TextBlock Text="{x:Bind Key}" 
                                                FontFamily="Segoe UI Semilight"
                                                FontSize="16"
                                                FontWeight="Normal" HorizontalAlignment="Center" 
                                                Foreground="Black"
                                                />
                                            </Border>
                                        </Grid>
                                    </DataTemplate>
                                </GroupStyle.HeaderTemplate>
                            </GroupStyle>
                        </ListView.GroupStyle>
                    </ListView>
                </Grid>

                <!--<Border Grid.Column="1">
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Top">
                        <ProgressRing x:Name="actionProgress" HorizontalAlignment="Center" VerticalAlignment="Center" Width="40" Height="40" Margin="0,0,0,15"/>
                        <AppBarButton x:Name="logAsCooked" x:Uid="LogAsCooked" HorizontalAlignment="Stretch" Label="" VerticalAlignment="Stretch" Icon="Like">
                            <AppBarButton.Flyout>
                                <DatePickerFlyout x:Name="CookedOn" Placement="Bottom">

                                </DatePickerFlyout>
                            </AppBarButton.Flyout>
                        </AppBarButton>
                        <AppBarButton x:Name="editNote" HorizontalAlignment="Stretch" Label="" VerticalAlignment="Stretch" Icon="Comment"
                                      Flyout="{StaticResource NoteEditorFlyout}"/>
                        <AppBarButton x:Uid="EditFile" ToolTipService.ToolTip="" x:Name="EditFileButton" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Icon="Edit" Visibility="Collapsed" />
                        <AppBarButton x:Uid="ImageGalery" ToolTipService.ToolTip="" x:Name="ShowImageGalery" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Icon="Pictures" />
                        <AppBarButton x:Uid="FullscreenView" ToolTipService.ToolTip="" x:Name="FullscreenView" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Icon="FullScreen" />
                        <AppBarButton x:Uid="AddToFavorites" ToolTipService.ToolTip="" x:Name="AddToFavorites" Label="" Icon="Pin"/>
                        <AppBarButton x:Uid="RemoveRecipe" ToolTipService.ToolTip="" x:Name="RemoveFromFavorites" HorizontalAlignment="Stretch" Label="" VerticalAlignment="Stretch" Visibility="Collapsed" Icon="UnPin"/>
                        <AppBarButton x:Name="Menu" ToolTipService.ToolTip="" Icon="More" VerticalAlignment="Center" HorizontalAlignment="Center" >
                            <Button.Flyout>
                                <MenuFlyout>
                                    <MenuFlyoutItem x:Uid="OpenRecipe" Text="" x:Name="OpenFile" />
                                    <MenuFlyoutItem x:Uid="Share" Text="" x:Name="Share" />
                                    <MenuFlyoutItem x:Uid="ChangeCategoryText" Text="" x:Name="ChangeCategory" />
                                    <MenuFlyoutItem x:Uid="RenameRecipe" Text="" x:Name="RenameRecipe" />
                                    <MenuFlyoutItem x:Uid="DeleteRecipe" Text="" x:Name="deleteRecipe" />
                                    <MenuFlyoutSeparator/>
                                    <MenuFlyoutItem x:Uid="ScanForCalories"  x:Name="ScanForCalories" />
                                    <MenuFlyoutItem x:Uid="ExportCaloricInfos"  x:Name="ExportCaloricInfos" />
                                    <MenuFlyoutItem x:Uid="ImportCaloricInfos"  x:Name="ImportCaloricInfos" />
                                </MenuFlyout>
                            </Button.Flyout>
                        </AppBarButton>
                    </StackPanel>
                </Border>-->

                <ListView Name="TagsList" Grid.Row="1" Grid.Column="1"
                          Style="{StaticResource WrappedItemsControlStyle}" 
                          ItemTemplateSelector="{StaticResource tagTemplateSelector}"/>

                <ContentPresenter Grid.Row="2" Grid.Column="1"
                        x:Name="DetailContentPresenter"
                        VerticalAlignment="Top"
                        BorderThickness="1,0,0,0"
                        Padding="24,0"
                        BorderBrush="{ThemeResource SystemControlForegroundBaseLowBrush}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="80"/>
                        </Grid.RowDefinitions>

                        <ScrollViewer
                                Grid.RowSpan="2"
        		                x:Name="itemDetail"
        		                AutomationProperties.AutomationId="ItemDetailScrollViewer"
                                VerticalAlignment="Top"
        		                DataContext="{Binding SelectedItem, ElementName=itemListView}"
        		                HorizontalScrollBarVisibility="Visible"
        		                ScrollViewer.HorizontalScrollMode="Enabled" ScrollViewer.VerticalScrollMode="Enabled"
        		                ScrollViewer.ZoomMode="Enabled"  >
                            <StackPanel Orientation="Vertical">
                                <Image x:Name="RecipeViewer"
                                       ScrollViewer.HorizontalScrollBarVisibility="Visible"
                                       ManipulationMode="TranslateX, TranslateY,System"
                                       ManipulationStarted="RecipeViewer_ManipulationStarted"
                                       ManipulationDelta="RecipeViewer_ManipulationDelta"
                                       ManipulationCompleted="RecipeViewer_ManipulationCompleted">
                                    <Image.RenderTransform>
                                        <CompositeTransform x:Name="RecipeViewer_Transform" />
                                    </Image.RenderTransform>
                                </Image>

                                <RichEditBox x:Name="RecipeSourceViewer"
                                     Visibility="Collapsed" IsEnabled="False" HorizontalAlignment="Center" VerticalAlignment="Top" Background="White" Style="{StaticResource RTFViewerStyle}" />
                            </StackPanel>
                        </ScrollViewer>

                        <!--<ScrollViewer>
                            <RichEditBox Grid.RowSpan="2" x:Name="RecipeSourceViewer"
                                     ScrollViewer.HorizontalScrollMode="Auto" 
                                     ScrollViewer.VerticalScrollMode="Auto" 
                                     ScrollViewer.VerticalScrollBarVisibility="Visible"
                                     ScrollViewer.HorizontalScrollBarVisibility="Visible"
                                     Visibility="Collapsed" IsEnabled="False" HorizontalAlignment="Center" VerticalAlignment="Top" Background="White" Style="{StaticResource RTFViewerStyle}" />
                        </ScrollViewer>-->

                        <StackPanel x:Name="pageControl"
                                            HorizontalAlignment="Center"
                                            VerticalAlignment="Center"
                                            Grid.Row="1"
                                            Orientation="Horizontal"
                                            Background="{StaticResource ListViewItemSelectedBackgroundThemeBrush}" Opacity="0.5" Visibility="Collapsed">
                            <AppBarButton x:Name="shrink" HorizontalAlignment="Center" Label="" VerticalAlignment="Center" Margin="0,10,0,0">
                                <AppBarButton.Icon>
                                    <FontIcon Glyph="&#xE71F;" Foreground="Black"/>
                                </AppBarButton.Icon>
                            </AppBarButton>
                            <AppBarButton x:Name="enlarge" HorizontalAlignment="Center" Label="" VerticalAlignment="Center" Margin="0,10,0,0">
                                <AppBarButton.Icon>
                                    <FontIcon Glyph="&#xE8A3;" Foreground="Black"/>
                                </AppBarButton.Icon>
                            </AppBarButton>

                            <AppBarSeparator x:Name="pageControlSeparator"/>

                            <AppBarButton x:Name="prevPage" HorizontalAlignment="Center" Label="" VerticalAlignment="Center" Margin="0,10,0,0">
                                <AppBarButton.Icon>
                                    <FontIcon Glyph="&#xE760;" Foreground="Black"/>
                                </AppBarButton.Icon>
                            </AppBarButton>
                            <TextBox x:Name="pageNumber" TextWrapping="Wrap" Text="1/2" IsReadOnly="True" PlaceholderText="2/2" FontSize="20" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            <AppBarButton x:Name="nextPage" HorizontalAlignment="Center" Label="" VerticalAlignment="Center" Margin="0,10,0,0">
                                <AppBarButton.Icon>
                                    <FontIcon Glyph="&#xE761;" Foreground="Black"/>
                                </AppBarButton.Icon>
                            </AppBarButton>
                        </StackPanel>
                    </Grid>
                    <ContentPresenter.ContentTransitions>
                        <!-- Empty by default. See MasterListView_ItemClick -->
                        <TransitionCollection />
                    </ContentPresenter.ContentTransitions>
                </ContentPresenter>
            </Grid>
        </SplitView>
    </SplitView>
</Page>
